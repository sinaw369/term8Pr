---
title: "گزارش پروژه کارشناسی - سامانه مدیریت و جستجوی لاگ با Go"
author: "دانشجو"
date: "خرداد 1404"
lang: fa
fontsize: 12pt
---

# صفحه عنوان

- دانشکده فنی و مهندسی
- گروه مهندسی کامپیوتر و فناوری اطلاعات
- گزارش پروژه جهت اخذ درجه کارشناسی
- رشته مهندسی کامپیوتر (نرم افزار)

## عنوان

طراحی و پیاده‌سازی پنل ادمین سبک برای جستجوی لاگ‌ها (بدون نیاز به Elasticsearch)

## نگارش

نام دانشجو: ...

## استاد راهنما

نام استاد: ...

---

# تقدیم به

به پدر و مادر عزیزم و همه کسانی که با محبت و همراهی، مسیر رشد و یادگیری را برایم هموار کردند.

---

# سپاسگزاری

از استاد راهنمای گرامی بابت راهنمایی‌های ارزشمند، از دوستان و همکلاسی‌ها بابت همکاری‌ها، و از خانواده عزیزم بابت حمایت‌های بی‌دریغشان صمیمانه قدردانی می‌کنم.

---

# فهرست مطالب

- چکیده
- فصل اول: مبانی نظری و فناوری‌های مورد استفاده
  - زبان برنامه‌نویسی Go (Golang)
  - فریم‌ورک Echo (وب)
  - پنل ادمین GoAdmin و تم AdminLTE
  - پایگاه‌داده SQLite
  - HTML / CSS / JavaScript و کتابخانه‌های گراف (ChartJS, ECharts)
- فصل دوم: مستند پیاده‌سازی و تحلیل سیستم
  - معماری، ساختار پوشه‌ها و ماژول‌ها
  - جریان اجرا (Flow)
  - لایه Handler / Service / Search / Backscanner
  - طراحی API جستجو و پاسخ‌ها
  - پنل ادمین و صفحات کاربردی پروژه
- فصل سوم: ارزیابی، کارایی و تست‌ها
- فصل چهارم: نتیجه‌گیری و کارهای آینده
- منابع

---

# چکیده

در این پروژه، یک سامانه سبک برای جستجوی لاگ‌ها در مقیاس‌های کوچک تا متوسط طراحی و پیاده‌سازی شده است که نیاز به راه‌حل‌های سنگینی مانند Elasticsearch را برطرف می‌کند. سیستم با زبان Go توسعه یافته، از Echo برای وب‌سرور، از GoAdmin برای پنل ادمین و از SQLite به‌عنوان پایگاه‌داده‌ی سبک استفاده می‌کند. منطق جستجو با استفاده از اسکن معکوس فایل‌ها (backscanner) و پردازش موازی (goroutine) طراحی شده تا بدون مصرف زیاد حافظه، خطوط اخیر و مرتبط را سریع بیابد و بازگرداند. خروجی‌ها به‌شکل JSON و امکان دریافت اکسل فراهم است. این راهکار برای فروشگاه‌ها و تیم‌های کوچک که نیاز به مشاهده سریع لاگ‌ها دارند، مناسب است.

---

# فصل اول: مبانی نظری و فناوری‌های مورد استفاده

## زبان برنامه‌نویسی Go (Golang)

- تاریخچه و فلسفه: طراحی توسط گوگل با تأکید بر سادگی، کارایی و هم‌زمانی.
- دلایل انتخاب در این پروژه:
  - هم‌زمانی قدرتمند با goroutine و channel برای پردازش موازی فایل‌ها.
  - کارایی و مصرف حافظه پایین، مناسب برای IO-bound بودن مسئله.
  - دیپلوی آسان (باینری تک‌فایله) و اکوسیستم مناسب برای وب و پایگاه‌داده.
- نحو و ویژگی‌ها:
  - تایپ ایستا، مدیریت خطا ساده، ابزارهای استاندارد (go fmt, go test, go mod).

## فریم‌ورک Echo (وب)

- Echo یک فریم‌ورک وب سریع برای Go است؛ مسیرها، میان‌افزارها و هندلرها را ساده می‌کند.
- در این پروژه برای راه‌اندازی سرور HTTP و اتصال با GoAdmin به‌کار رفته است.

## پنل ادمین GoAdmin و تم AdminLTE

- GoAdmin پنل مدیریتی آماده بر بستر Go است؛ تم AdminLTE تجربه کاربری استانداردی ارائه می‌دهد.
- قابلیت‌هایی مانند تعریف صفحه، منو، جدول، فرم، و اعمال فیلترها را ساده می‌کند.

## پایگاه‌داده SQLite

- پایگاه‌داده سبکِ فایل‌محور برای محیط‌های کوچک؛ بدون نیاز به سرویس جداگانه.
- مدیریت schema از طریق migration های داخل پروژه.

## HTML / CSS / JavaScript و کتابخانه‌های گراف

- برای نمایش عناصر UI و نمودارها از ChartJS و ECharts استفاده شده است.

---

# فصل دوم: مستند پیاده‌سازی و تحلیل سیستم

## معماری کلان و ساختار پوشه‌ها

- لایه ارائه: GoAdmin + Echo (تعریف صفحات و ثبت مسیرها)
- لایه کاربرد: handler (تبدیل ورودی‌ها و واکشی سرویس)
- لایه دامنه: service و search (منطق جستجو)
- لایه داده: Tdata (راه‌اندازی DB و migration ها)

ساختار کلیدی پروژه:

```text
Tdata/           # DB و مهاجرت‌ها
Tpage/           # صفحات پنل و UI
Tmenu/           # منوهای پنل
handler/         # لایه هندلر/سرویس/موتور جستجو
  SearchLogsEng/
    backscanner/
    search/
    service/
    params/
main.go          # راه‌اندازی Echo و GoAdmin
logs/            # لاگ‌های نمونه
uploads/         # دارایی‌ها و آپلودها
```

## جریان اجرا (Flow)

1) کاربر در پنل GoAdmin به صفحه جستجو می‌رود یا درخواست POST به `/search` ارسال می‌کند.
2) `SearchLogHandlerExternal` ورودی فرم را به مدل `SearchLogRequest` تبدیل می‌کند.
3) سرویس `adminService` روش `GetFilesInFolder` را در `search` فراخوانی می‌کند.
4) موتور جستجو فایل‌ها را به‌صورت معکوس و موازی می‌خواند، فیلتر می‌کند و نتیجه را برمی‌گرداند.

## راه‌اندازی برنامه (برگزیده از main.go)

- پیکربندی GoAdmin با SQLite و تم `adminlte`، ثبت مسیرهای UI و API.
- ثبت مسیرها:
  - `/admin` (UI)
  - `/admin/healthCheck` (سلامت)
  - `/search` (جستجوی لاگ‌ها، POST)

## لایه Handler (adminHandler)

- تابع `SearchLogHandlerExternal` ورودی‌ها را می‌خواند: `year, month, day, logType, limit, searchKey, fileName, notInclude*`.
- حالت `countOnly` فقط شمارنده نتایج را برمی‌گرداند.
- پاسخ با `Content-Type: application/json` ارسال می‌شود.

## لایه Service (adminService)

- تعریف واسط `SearchLogs` و تزریق وابستگی.
- هماهنگ‌کننده بین Handler و منطق جستجو.

## موتور جستجو (search)

- `GetFileNames`: ساخت مسیر روزانه `logs/YYYY-MM-DD[/errors]`، فیلتر نام فایل‌ها، حذف فایل‌های خالی.
- `CreateReaderForFile`: ایجاد `backscanner.Scanner` برای هر فایل معتبر.
- `ProcessFile`: خواندن معکوس خطوط در goroutine ها، محدودسازی با semaphore.
- `CreateLine`: پارس خطوط JSON/متن و تبدیل `time` به نوع زمان.
- `ProcessLine2`: فیلتر on-the-fly با `SearchKey`/`NotIncludeSearchKey` و توقف در `limit`.
- مرتب‌سازی نهایی براساس زمان و تولید خروجی JSON خوانا.

## اسکن معکوس فایل (backscanner)

- خواندن chunk-محور از انتهای فایل، پیدا کردن `\n` و بازگردانی خطوط.
- کنترل حافظه با `MaxBufferSize`، مدیریت `io.EOF` و خط‌های بلند.

## API جستجو و نمونه پاسخ

- Endpoint: `POST /search`
- پارامترهای مهم: `year, month, day, logType, limit, searchKey, fileName, notInclude*`

نمونه درخواست:

```bash
curl -X POST http://localhost:1235/search \
  -d year=2024 -d month=06 -d day=10 \
  -d logType=errors -d limit=50 \
  -d searchKey=timeout
```

## پنل ادمین و صفحات کاربردی

- صفحات پیش‌فرض: Dashboard، Form، Table، User.
- صفحه جستجوی لاگ‌ها: ارسال فرم و نمایش نتایج.
- خروجی اکسل: دانلود فایل `Search_result.xlsx` پس از ایجاد.

---

# فصل سوم: ارزیابی، کارایی و تست‌ها

## کارایی

- IO-bound: گلوگاه دیسک؛ پردازش موازی و فیلتر زودهنگام throughput را بالا می‌برد.
- پارامترهای تیونینگ: ظرفیت کانال‌ها، تعداد goroutine ها، `DefultReadLine`.

## تست‌ها

- واحد: `GetFileNames`, `CreateLine`, فیلترها.
- ادغامی: ساخت پوشه‌های لاگ نمونه و فراخوانی `/search`.
- دستی: سناریوهای فایل خالی، فایل بزرگ، چندفایل همزمان.

---

# فصل چهارم: نتیجه‌گیری و کارهای آینده

- نتیجه: راهکاری سبک، ساده و مؤثر برای مشاهده و جستجوی لاگ بدون Elasticsearch.
- کارهای آینده: هایلایت عبارت، صفحه‌بندی، زمان‌بندی گزارش‌ها، RBAC کامل، پشتیبانی فرمت‌های بیشتر.

---

# منابع

- اسناد رسمی Go, Echo, GoAdmin, SQLite
- کد پروژه حاضر و کامنت‌های توضیحی

